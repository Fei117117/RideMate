import sqlalchemy
from sqlalchemy import create_engine
import traceback
import glob
import os
from pprint import pprint
import simplejson as json
import requests
import time
# from IPython.display import display

URI = "dbbikes.c06rsktpo8sk.us-east-1.rds.amazonaws.com"
PORT = "3306"
DB = "dbbikes"
USER = "minhly"
PASSWORD = "22201371"
engine = create_engine(
    "mysql+mysqlconnector://{}:{}@{}:{}/{}".format(USER, PASSWORD, URI, PORT, DB), echo=True)

sql = """CREATE DATABASE IF NOT EXISTS dbbikes"""
engine.execute(sql)

for res in engine.execute("SHOW VARIABLES"):
    print(res)

sql = """
CREATE TABLE IF NOT EXISTS station
(
address VARCHAR(256),
banking INTEGER,
bike_stands INTEGER,
bonus INTEGER,
contract_name VARCHAR(256),
name VARCHAR(256),
number INTEGER NOT NULL,
position_lat REAL,
position_lng REAL,
status VARCHAR(256),
last_update INT(11) UNSIGNED NOT NULL,
PRIMARY KEY (number, last_update)
)
"""
try:
    res = engine.execute("DROP TABLE IF EXISTS station")
    res = engine.execute(sql)
    print(res.fetchall())
except Exception as e:
    print(e)

sql = """
CREATE TABLE IF NOT EXISTS availability
(
number INTEGER NOT NULL,
last_update INT(11) UNSIGNED NOT NULL,
available_bikes INTEGER,
available_bike_stands INTEGER,
status VARCHAR(256),
PRIMARY KEY (number, last_update)
)
"""
try:
    res = engine.execute("DROP TABLE IF EXISTS availability")
    res = engine.execute(sql)
    print(res.fetchall())
except Exception as e:
    print(e)

sql = """
CREATE TABLE IF NOT EXISTS weather
(
station INTEGER NOT NULL,
last_update INT(11) UNSIGNED NOT NULL,
temperature REAL,
weathercode INTEGER,
windspeed REAL,
hourly_time VARCHAR(150),
hourly_temp VARCHAR(90),
hourly_preci VARCHAR(70),
hourly_weathercode VARCHAR(70),
hourly_windspeed VARCHAR(90),
daily_time VARCHAR(90),
daily_weathercode VARCHAR(40),
daily_temp_max VARCHAR(60),
daily_temp_min VARCHAR(60),
PRIMARY KEY (station, last_update)
)
"""

sql 
try:
    res = engine.execute("DROP TABLE IF EXISTS weather")
    res = engine.execute(sql)
    print(res.fetchall())
except Exception as e:
    print(e)
